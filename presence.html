<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Présence - Kourel 1 Daara Fathul Qaffar Touba Mohammedia</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .main-content {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.10);
            margin: 40px auto 30px auto;
            max-width: 900px;
            padding: 40px 30px;
        }
        .decor-separator {
            width: 120px;
            height: 5px;
            background: linear-gradient(90deg, #005600 60%, #39d353 100%);
            border-radius: 8px;
            margin: 18px auto 30px auto;
        }
        footer {
            background: #003A00;
            color: #f8f9fa;
            text-align: center;
            padding: 18px 0 10px 0;
            border-radius: 12px 12px 0 0;
            margin-top: 40px;
        }
        .table thead {
            background: linear-gradient(90deg, #005600 60%, #39d353 100%);
            color: #fff;
        }
        .btn-present {
            background: #39d353;
            color: #fff;
        }
        .btn-absent {
            background: #e74c3c;
            color: #fff;
        }
        .stat-box {
            background: rgba(0,86,0,0.08);
            border-radius: 12px;
            padding: 18px 20px;
            margin-bottom: 18px;
            text-align: center;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(40px);}
            to { opacity: 1; transform: translateY(0);}
        }
        .row.justify-content-center > div {
            animation: fadeInUp 0.8s;
        }
    </style>
</head>
<body>
    <!-- Menu Bootstrap (identique à Accueil.html) -->
    <nav class="navbar navbar-expand-lg" style="background-color: #003A00;">
        <div class="container">
            <a class="navbar-brand" style="color: #f8f9fa;" href="Accueil.html">MonSite</a>
            <button class="navbar-toggler bg-white" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="Accueil.html">Accueil</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">A propos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Contact</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="xassidaDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Xassida
                        </a>
                        <ul style="background-color: #003A00;" id="sousMenuDesXassida" class="dropdown-menu text-white" aria-labelledby="xassidaDropdown">
                            <li><a class="dropdown-item" href="Xassidas/WadieuhtoulilahiHamdan.html">Wadieuhtoulilahi hamdan</a></li>
                            <li><a class="dropdown-item" href="#">Xassida 2</a></li>
                            <li><a class="dropdown-item" href="#">Xassida 3</a></li>
                        </ul>
                    </li>
                    <li>
                        <a class="nav-link text-white mr-4" href="#">Se connecter</a>
                    </li>
                    <li>
                        <a class="nav-link text-white" href="#">Se deconnecter</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Contenu principal -->
    <div class="main-content">
        <h1 class="mb-2 text-center" style="color:#003A00;">Présence Kourel 1</h1>
        <div class="decor-separator"></div>

        <!-- Statistiques d'assiduité -->
        <div class="row mb-4">
            <div class="col-md-4 stat-box">
                <div id="stat-total" style="font-size:2em;font-weight:bold;">0</div>
                <div>Membres</div>
            </div>
            <div class="col-md-4 stat-box">
                <div id="stat-present" style="font-size:2em;font-weight:bold;">0</div>
                <div>Présents</div>
            </div>
            <div class="col-md-4 stat-box">
                <div id="stat-absent" style="font-size:2em;font-weight:bold;">0</div>
                <div>Absents</div>
            </div>
        </div>

        <!-- Formulaire d'ajout de membre -->
        <form class="row g-3 mb-4" id="addMemberForm" autocomplete="off">
            <div class="col-md-6">
                <input type="text" class="form-control" id="memberName" placeholder="Nom du membre" required>
            </div>
            <div class="col-md-4">
                <select class="form-select" id="memberStatus">
                    <option value="present">Présent</option>
                    <option value="absent">Absent</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-success w-100">Ajouter</button>
            </div>
        </form>

        <!-- Tableau des présences -->
        <div class="table-responsive">
            <table class="table table-bordered align-middle" id="presenceTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Nom</th>
                        <th>Statut</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Membres ajoutés ici dynamiquement -->
                </tbody>
            </table>
        </div>

        <!-- Bouton d'injection des données dans la page d'accueil -->
        <div class="text-end mt-3">
            <button class="btn btn-primary" id="injectToAccueil">
                Injecter les présences/absences dans la page d'accueil
            </button>
        </div>
    </div>

    <!-- Pied de page -->
    <footer>
        &copy; 2025 Kourel 1 Daara Fathul Qaffar Touba Mohammedia. Tous droits réservés.
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Gestion des membres (stockage local simple)
    let members = JSON.parse(localStorage.getItem('kourel1_presence') || '[]');

    // Ajout d'un membre avec historique
    document.getElementById('addMemberForm').onsubmit = function(e) {
        e.preventDefault();
        const name = document.getElementById('memberName').value.trim();
        const status = document.getElementById('memberStatus').value;
        if(name) {
            members.push({
                name,
                status,
                history: [{date: new Date().toLocaleString(), status}],
                phone: prompt("Entrer le numéro WhatsApp du membre (ex: 771234567):", "")
            });
            renderTable();
            this.reset();
        }
    };

    // Mise à jour du statut avec historique
    function setStatus(index, status) {
        members[index].status = status;
        if (!members[index].history) members[index].history = [];
        members[index].history.push({date: new Date().toLocaleString(), status});
        renderTable();
    }

    // Supprimer un membre
    function removeMember(index) {
        members.splice(index, 1);
        renderTable();
    }

    // Affichage du tableau avec bouton WhatsApp si absent
    function renderTable() {
        const tbody = document.querySelector('#presenceTable tbody');
        tbody.innerHTML = '';
        members.forEach((m, i) => {
            let whatsappBtn = '';
            if (m.status === 'absent' && m.phone && m.phone.length >= 8) {
                // Format international pour WhatsApp (par défaut +221 pour Sénégal, à adapter si besoin)
                let phone = m.phone.replace(/^0+/, '');
                if (!phone.startsWith('221') && !phone.startsWith('+221')) phone = '221' + phone;
                phone = phone.replace(/^\+/, '');
                whatsappBtn = `<a class="btn btn-sm btn-success ms-1" target="_blank" href="https://wa.me/221${phone}?text=Bonjour%20${encodeURIComponent(m.name)},%20vous%20êtes%20marqué%20absent%20au%20Kourel%201.">
                    WhatsApp
                </a>`;
            }
            tbody.innerHTML += `
                <tr>
                    <td>${i+1}</td>
                    <td style="cursor:pointer;" onclick="showHistory(${i})">${m.name}</td>
                    <td>
                        <span class="badge ${m.status === 'present' ? 'bg-success' : 'bg-danger'}">
                            ${m.status === 'present' ? 'Présent' : 'Absent'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-present" onclick="setStatus(${i},'present')">Présent</button>
                        <button class="btn btn-sm btn-absent" onclick="setStatus(${i},'absent')">Absent</button>
                        <button class="btn btn-sm btn-secondary" onclick="removeMember(${i})">Supprimer</button>
                        ${whatsappBtn}
                    </td>
                </tr>
            `;
        });
        updateStats();
        localStorage.setItem('kourel1_presence', JSON.stringify(members));
    }

    // Affichage de l'historique au clic sur le nom
    function showHistory(idx) {
        const member = members[idx];
        if (member.history && member.history.length) {
            let msg = `Historique de ${member.name} :\n\n`;
            member.history.forEach(h => {
                msg += `${h.date} : ${h.status === 'present' ? 'Présent' : 'Absent'}\n`;
            });
            alert(msg);
        } else {
            alert("Aucun historique pour ce membre.");
        }
    }

    // Statistiques
    function updateStats() {
        document.getElementById('stat-total').textContent = members.length;
        document.getElementById('stat-present').textContent = members.filter(m => m.status === 'present').length;
        document.getElementById('stat-absent').textContent = members.filter(m => m.status === 'absent').length;
    }

    // Fonction pour injecter les données dans la page d'accueil (localStorage)
    document.getElementById('injectToAccueil').onclick = function() {
        // On enregistre la liste actuelle dans une clé dédiée pour l'accueil
        localStorage.setItem('kourel1_presence_accueil', JSON.stringify(members));
        alert("Les informations de présence/absence ont été injectées pour la page d'accueil !");
        window.location.href='Accueil.html';
    };

    // Initialisation
    renderTable();
    </script>
</body>
</html>